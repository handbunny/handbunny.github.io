<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sistema HandBunny</title>
    <!-- CSS-->
    <link href="css/bootstrap.css" rel="stylesheet">


    <!-- Fim - CSS-->
  </head>
  <body style="background-color: #efefef;">
    <!--Menu-->
    <div class="container">
        <header class="d-flex justify-content-center py-3">
          <ul class="nav nav-pills">
            <li class="nav-item"><a href="index.html" class="nav-link" aria-current="page">Página Inicial</a></li>
            <li class="nav-item"><a href="slide.html" class="nav-link">Apresentação de Slides</a></li>
            <li class="nav-item"><a href="desenho.html" class="nav-link active">Desenho em Tela</a></li>
          </ul>
        </header>
    </div>
    <!-- Fim - Menu-->

    <div class="container text-center">
      <div class="row">


      <!-- Coluna 1 Slide-->
        <div class="col-sm-8">
          <div class="card">
            <h5 class="card-header">Apresentação <span class="badge bg-secondary">PDF somente</span></h5>            
            <div class="card-body" style="background-color: #8d99ae;">
              <div class="card-body">
                <canvas id="canvas" width="500" height="500"></canvas>
              </div>
              <br>
              <div>
                <button class="btn btn-primary" id="limpar">Limpar</button>
              </div>
              <br>           
            </div>
          </div>
        </div>
      <!-- Fim - Coluna 1 Slide-->

      <!-- Coluna 2 Cameras-->
        <div class="col-sm-4">
          <div class="card text-center mb-3">
            <h5 class="card-header">WebCam</h5>
            <div class="card-body">

              <!--Camera webcam-->
                <div class="row">       
                  <video class="input_video"style="width: 100%; height: 100%; display:none"></video>
                </div>
              <!--Fim - Camera webcam-->

              <!--Output com sinais-->
                <div class="row">       
                    <canvas class="output_canvas" style="display: flex; justify-content: center; align-items: center;"></canvas>
                    <div class="caption">Direção do dedo: <span id="finger-direction"></span></div>
                </div>
              <!--Fim - Output com sinais-->

            </div>
          </div>
        </div>
      <!-- Fim - Coluna 2 Cameras-->


      </div>
    </div>
<!-- Javascript-->
    <!-- Mediapipe-->
      <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    
    <!-- Bootstrap-->
      <script src="js/bootstrap.min.js" integrity="sha384-3oE51fG8R+q4yjzUHnlgUvVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7TxaGv6f1" crossorigin="anonymous"></script>

      <script src="//mozilla.github.io/pdf.js/build/pdf.js"></script>
      <script>
        const canvas = document.getElementById("canvas");
const context = canvas.getContext("2d");

let isDrawing = false;
let lastPoint = null;

function draw(point) {
  if (lastPoint == null) {
    lastPoint = point;
  }

  context.beginPath();
  context.moveTo(lastPoint.x, lastPoint.y);
  context.lineTo(point.x, point.y);
  context.stroke();

  lastPoint = point;
}

function startDrawing() {
  isDrawing = true;
}

function stopDrawing() {
  isDrawing = false;
  lastPoint = null;
}

canvas.addEventListener("mousedown", startDrawing);
canvas.addEventListener("mouseup", stopDrawing);
canvas.addEventListener("mouseleave", stopDrawing);

const hands = new Hands({locateFile: (file) => {
  return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
}});
hands.setOptions({
  maxNumHands: 1,
  minDetectionConfidence: 0.5,
  minTrackingConfidence: 0.5,
});
hands.onResults((results) => {
  if (results.multiHandLandmarks) {
    const handLandmarks = results.multiHandLandmarks[0];
    const indexFinger = handLandmarks[8];

    const x = indexFinger.x * canvas.width;
    const y = indexFinger.y * canvas.height;

    if (isDrawing) {
      draw({x, y});
    }
  }
});
hands.start();

      </script>
    </body>
</html>